})
X.strain <- model.matrix(~(lab_id)^2, data = data_strain.newdata)
dim(X.strain)
dim(beta)
mu_strain <- t(X.strain%*%t(beta))
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
View(data_strain.newdata)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
c_value <- subset(Fasit_data, Strain_no == target_strain)
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
max_indices <- which.max(table(data_strain.data.sub$MIC.num))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
#
max_value <- as.numeric(names(max_indices))
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(max_value)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
c_value <- subset(Fasit_data, Strain_no == target_strain)
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
max_indices <- which.max(table(data_strain.data.sub$MIC.num))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
#
max_value <- as.numeric(names(max_indices))
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(max_value)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
data_strain.newdata <- within(data_strain.newdata, {
lower.log.MIC.naive <- E.log.MIC.naive - 1.96 * se.log.MIC.naive
upper.log.MIC.naive <- E.log.MIC.naive + 1.96 * se.log.MIC.naive
})
X.strain <- model.matrix(~(lab_id)^2, data = data_strain.newdata)
dim(X.strain)
dim(beta)
mu_strain <- t(X.strain%*%t(beta))
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
print(lab_id_v)
#
# c_value <- subset(Fasit_data, Strain_no == target_strain)
#
# data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
# mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
#
# max_indices <- which.max(table(data_strain.data.sub$MIC.num))
# Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
# if(Y_act <0) Y_act <- Y_act*-1
# #
# max_value <- as.numeric(names(max_indices))
#
# data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
# data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
#
# data_strain.newdata[k, "mode.log.MIC"] <- log2(max_value)
# data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
#
k <- k+1
}
c_value <- subset(Fasit_data, Strain_no == target_strain)
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
max_indices <- which.max(table(data_strain.data.sub$MIC.num))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
#
max_value <- as.numeric(names(max_indices))
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(max_value)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
View(data.sub)
View(data_strain.data.sub)
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
data_strain.newdata <- within(data_strain.newdata, {
lower.log.MIC.naive <- E.log.MIC.naive - 1.96 * se.log.MIC.naive
upper.log.MIC.naive <- E.log.MIC.naive + 1.96 * se.log.MIC.naive
})
X.strain <- model.matrix(~(lab_id)^2, data = data_strain.newdata)
dim(X.strain)
dim(beta)
mu_strain <- t(X.strain%*%t(beta))
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
Fasit_data$LIN_MIC_MTS <-as.numeric(sub("<", "", sub("<=", "" ,sub(">", "", sub(c(">="), "", ifelse(Fasit_data$LIN_MIC_MTS==">256", 512,Fasit_data$LIN_MIC_MTS))))))
target_strain <- 1
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
target_strain <- 1
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
target_strain <- 1
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
k<-1
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
data_strain.newdata <- within(data_strain.newdata, {
lower.log.MIC.naive <- E.log.MIC.naive - 1.96 * se.log.MIC.naive
upper.log.MIC.naive <- E.log.MIC.naive + 1.96 * se.log.MIC.naive
})
X.strain <- model.matrix(~(lab_id)^2, data = data_strain.newdata)
dim(X.strain)
dim(beta)
mu_strain <- t(X.strain%*%t(beta))
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
val <- ifelse(grepl("Etest_Strain", name),lab_id,Strain_no)
print(val)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
library(openxlsx)
source("C:/Users/ayoung/Desktop/Thesis/real_data/plots.R")
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
View(data_strain.newdata)
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
draw_plot(data_strain.newdata,paste0("Etest_Strain",target_strain),X.strain)
n <- ncol(X.strain)
d <- 0.25
pdf(file = paste0("figure_Strain_",target_strain,".pdf"), width = 7, height = 7 * sqrt(2))
par(mar = c(8,5.5,2, 5), yaxs = "i");
plot.new();
plot.window(xlim = c(-10, 8), c(n+0.5, 0.5))
abline(h = seq(0.5, n+0.5, 1), col = 8);
abline(h = c(10.5, 20.5), lwd = 2); box();
axis(1, at = seq(-9, 7, 2), labels = signif(2^seq(-9, 7, 2), 3), cex.axis = 0.7)
axis(2, at = 1:n, labels = with(data_strain.newdata, levels(interaction(lab_id, sep = " "))), las = 1, cex.axis = 0.7)
title(xlab = "MIC")
with(data_strain.newdata, {
points(mode.log.MIC, 1:n, pch = 0, cex = 0.7) #open squares - mod MICs
points(E.log.MIC, 1:n-d, pch = 15, cex = 0.7) #solid square - Predicted mean MICs and
segments(lower.log.MIC, 1:n-d, upper.log.MIC, 1:n-d)
points(lower.log.MIC.ref, 1:n+d, col = 1, cex = 0.7) #open circles - lower boundary accounting for interval censoring
points(upper.log.MIC.ref, 1:n+d, col = 1, pch = 16, cex = 0.7) # solid circles - reference MICs
segments(lower.log.MIC.ref, 1:n+d, upper.log.MIC.ref, 1:n+d, col = 1)
})
par(xpd=TRUE)
par(new=T)
par(fig=c(0, 1, 0, 0.2), mar=c(2,2,2,2))
#lower boundary accounting for
legend("bottomright", legend = c("Mode MICs", "mean MICs", "interval censoring", " reference MICs"),
pch = c(0,
15, 1, 16, 1), col = c("black", "black", "black", "black"),
cex = 0.7, bty = "n")
dev.off()
system( paste0("figure_Strain_",target_strain,".pdf"))
data_strain <- subset(data, Strain_no == target_strain)
View(data_strain)
View(data_strain.newdata)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
k<-1
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
View(data_strain.newdata)
data_strain.newdata <- within(data_strain.newdata, {
lower.log.MIC.naive <- E.log.MIC.naive - 1.96 * se.log.MIC.naive
upper.log.MIC.naive <- E.log.MIC.naive + 1.96 * se.log.MIC.naive
})
View(data_strain.newdata)
View(data_strain.data.sub)
k<-1
target_strain <- 1
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
k<-1
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
print(mod)
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
k <- k+1
}
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
k<-1
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
print(mod)
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
print(sqrt(vcov(mod)))
k <- k+1
}
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
print(mod)
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
print(sqrt(vcov(mod)))
k <- k+1
}
data_strain.newdata <- within(data_strain.newdata, {
lower.log.MIC.naive <- E.log.MIC.naive - 1.96 * se.log.MIC.naive
upper.log.MIC.naive <- E.log.MIC.naive + 1.96 * se.log.MIC.naive
})
X.strain <- model.matrix(~(lab_id)^2, data = data_strain.newdata)
mu_strain <- t(X.strain%*%t(beta))
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
n <- ncol(X.strain)
d <- 0.25
pdf(file = paste0("figure_Strain_",target_strain,".pdf"), width = 7, height = 7 * sqrt(2))
par(mar = c(8,5.5,2, 5), yaxs = "i");
plot.new();
plot.window(xlim = c(-10, 8), c(n+0.5, 0.5))
abline(h = seq(0.5, n+0.5, 1), col = 8);
abline(h = c(10.5, 20.5), lwd = 2); box();
axis(1, at = seq(-9, 7, 2), labels = signif(2^seq(-9, 7, 2), 3), cex.axis = 0.7)
axis(2, at = 1:n, labels = with(data_strain.newdata, levels(interaction(lab_id, sep = " "))), las = 1, cex.axis = 0.7)
title(xlab = "MIC")
with(data_strain.newdata, {
points(mode.log.MIC, 1:n, pch = 0, cex = 0.7) #open squares - mod MICs
# points(E.log.MIC, 1:n-d, pch = 15, cex = 0.7) #solid square - Predicted mean MICs and
# segments(lower.log.MIC, 1:n-d, upper.log.MIC, 1:n-d)
# points(lower.log.MIC.ref, 1:n+d, col = 1, cex = 0.7) #open circles - lower boundary accounting for interval censoring
# points(upper.log.MIC.ref, 1:n+d, col = 1, pch = 16, cex = 0.7) # solid circles - reference MICs
# segments(lower.log.MIC.ref, 1:n+d, upper.log.MIC.ref, 1:n+d, col = 1)
})
par(xpd=TRUE)
par(new=T)
par(fig=c(0, 1, 0, 0.2), mar=c(2,2,2,2))
#lower boundary accounting for
legend("bottomright", legend = c("Mode MICs", "mean MICs", "interval censoring", " reference MICs"),
pch = c(0,
15, 1, 16, 1), col = c("black", "black", "black", "black"),
cex = 0.7, bty = "n")
# labs compared to mean
lab.data <- data.frame(
lab = levels(data$lab_id),
diff.log.MIC = colMeans(b.lab),
lower.diff.log.MIC = apply(b.lab, 2, quantile, 0.025),
upper.diff.log.MIC = apply(b.lab, 2, quantile, 0.975))
Fasit_data$LIN_MIC_MTS <-as.numeric(sub("<", "", sub("<=", "" ,sub(">", "", sub(c(">="), "", ifelse(Fasit_data$LIN_MIC_MTS==">256", 512,Fasit_data$LIN_MIC_MTS))))))
target_strain <- 1
data_strain <- subset(data, Strain_no == target_strain)
data_strain.newdata <- with(data_strain, expand.grid(lab_id = levels(lab_id)))
data_strain.sub <- within(data_strain.newdata, {lower.log.MIC.ref <- NA; upper.log.MIC.ref <- NA;})
data_strain.newdata <- within(data_strain.newdata, {mode.log.MIC<-NA; E.log.MIC.naive <- NA; se.log.MIC.naive <- NA;})
data_strain$Strain_no<-drop.levels(data_strain$Strain_no)
head(data_strain$Strain_no)
data_strain$lab_id<-drop.levels(data_strain$lab_id)
head(data_strain$lab_id)
c_value <- subset(Fasit_data, Strain_no == target_strain)
k<-1
for (i in 1:nlevels(data_strain$lab_id)) {
lab_id_v <- levels(data_strain$lab_id)[i]
data_strain.data.sub <- subset(data_strain, lab_id == lab_id_v)
mod <- with(data_strain.data.sub, lm(log.MIC.naive ~ 1))
print(mod)
Y_act <- rnorm(n=1,mean=c_value$LIN_MIC_MTS,sd=c_value$LIN_MIC_MTS*2)
if(Y_act <0) Y_act <- Y_act*-1
data_strain.sub[k,"lower.log.MIC.ref"]<-2^floor(log2(Y_act))
data_strain.sub[k,"upper.log.MIC.ref"]<- 2^ceiling(log2(Y_act))
data_strain.newdata[k, "mode.log.MIC"] <- log2(data_strain.data.sub$MIC.num)
data_strain.newdata[k, c("E.log.MIC.naive", "se.log.MIC.naive")] <- c(coef(mod), sqrt(vcov(mod)))
print(sqrt(vcov(mod)))
k <- k+1
}
data_strain.newdata <- within(data_strain.newdata, {
lower.log.MIC.naive <- E.log.MIC.naive - 1.96 * se.log.MIC.naive
upper.log.MIC.naive <- E.log.MIC.naive + 1.96 * se.log.MIC.naive
})
X.strain <- model.matrix(~(lab_id)^2, data = data_strain.newdata)
mu_strain <- t(X.strain%*%t(beta))
data_strain.newdata <- within(data_strain.newdata, {
E.log.MIC <- colMeans(mu_strain)
lower.log.MIC <- apply(mu_strain, 2, quantile, 0.025)
upper.log.MIC <- apply(mu_strain, 2, quantile, 0.975)
})
data_strain.newdata <- merge(data_strain.newdata, data_strain.sub, sort = F)
n <- ncol(X.strain)
d <- 0.25
pdf(file = paste0("figure_Strain_",target_strain,".pdf"), width = 7, height = 7 * sqrt(2))
par(mar = c(8,5.5,2, 5), yaxs = "i");
plot.new();
plot.window(xlim = c(-10, 8), c(n+0.5, 0.5))
abline(h = seq(0.5, n+0.5, 1), col = 8);
abline(h = c(10.5, 20.5), lwd = 2); box();
axis(1, at = seq(-9, 7, 2), labels = signif(2^seq(-9, 7, 2), 3), cex.axis = 0.7)
axis(2, at = 1:n, labels = with(data_strain.newdata, levels(interaction(lab_id, sep = " "))), las = 1, cex.axis = 0.7)
title(xlab = "MIC")
with(data_strain.newdata, {
points(mode.log.MIC, 1:n, pch = 0, cex = 0.7) #open squares - mod MICs
# points(E.log.MIC, 1:n-d, pch = 15, cex = 0.7) #solid square - Predicted mean MICs and
# segments(lower.log.MIC, 1:n-d, upper.log.MIC, 1:n-d)
# points(lower.log.MIC.ref, 1:n+d, col = 1, cex = 0.7) #open circles - lower boundary accounting for interval censoring
# points(upper.log.MIC.ref, 1:n+d, col = 1, pch = 16, cex = 0.7) # solid circles - reference MICs
# segments(lower.log.MIC.ref, 1:n+d, upper.log.MIC.ref, 1:n+d, col = 1)
})
par(xpd=TRUE)
par(new=T)
par(fig=c(0, 1, 0, 0.2), mar=c(2,2,2,2))
#lower boundary accounting for
legend("bottomright", legend = c("Mode MICs", "mean MICs", "interval censoring", " reference MICs"),
pch = c(0,
15, 1, 16, 1), col = c("black", "black", "black", "black"),
cex = 0.7, bty = "n")
dev.off()
system( open(paste0("figure_Strain_",target_strain,".pdf")))
